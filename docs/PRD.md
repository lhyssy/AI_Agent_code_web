# AI Code Team - 产品需求文档(PRD)

## 1. 产品定位与目标

### 1.1 产品名称
AI Code Team

### 1.2 产品定位
面向初学者的智能代码生成协作平台

### 1.3 目标用户
- **主要用户**: 编程初学者
- **次要用户**: 需要快速原型开发的开发者

### 1.4 核心价值
通过AI代理团队协作,将自然语言需求转化为可运行代码

## 2. 功能模块规划

### 2.1 核心功能模块
1. 用户对话模块
2. AI团队协作模块
3. 代码生成展示模块
4. 可视化协作流程模块

## 3. 详细功能描述

### 3.1 用户对话模块
#### 功能描述
- 支持用户通过自然语言输入需求
- 支持多轮对话修改和调整
- 实时显示对话历史

#### 交互设计
- 输入框位于页面底部
- 对话气泡区分用户和AI角色
- 支持代码块高亮显示

#### 3.1.6 聊天历史查看

为提升用户查看历史消息的体验，聊天窗口应具备以下功能：

- **滚动导航**：提供明显的滚动控制按钮，方便用户快速跳转到消息的不同部分
- **滚动位置指示**：显示当前在消息列表中的位置，提供视觉反馈
- **自动滚动控制**：
  - 新消息到达时自动滚动到底部
  - 当用户手动滚动查看历史消息时，暂时禁用自动滚动
  - 手动滚动查看历史消息时，若有新消息，显示新消息提示
- **历史消息加载**：提供加载更多历史消息的功能，并显示加载状态

### 3.2 AI团队协作模块
#### 团队成员角色
1. **Mike (团队领导)**
   - 负责任务分配
   - 团队协调
   - 与用户直接对话

2. **Emma (产品经理)**
   - 需求分析
   - 功能规划
   - 用户体验建议

3. **Bob (架构师)**
   - 系统架构设计
   - 技术选型建议
   - 代码结构规划

4. **Alex (工程师)**
   - 具体代码实现
   - 代码优化
   - 测试验证

### 3.3 代码生成展示模块
#### 功能描述
- 实时展示生成的代码
- 支持代码高亮
- 支持代码复制
- 支持下载完整项目文件

#### 展示格式
- 分类展示HTML/CSS/JS代码
- 支持预览效果
- 显示文件结构

### 3.4 可视化协作流程模块
#### 功能描述
- 实时展示团队成员协作过程
- 可视化任务分配流程
- 展示决策路径
- 支持节点拖拽调整位置
- 支持一键重置节点位置
- 点击节点显示角色详细信息

#### 可视化元素
- 节点表示团队成员，使用不同颜色区分角色
- 连线表示协作关系，带有动画效果
- 节点支持交互式拖拽
- 角色信息弹窗优化显示
- 重置按钮位于右上角

#### 交互特性
- 节点拖拽时保持连线跟随
- 点击节点显示角色描述弹窗
- 再次点击同一节点关闭弹窗
- 拖拽时自动隐藏描述弹窗
- 重置功能恢复初始布局

## 4. 技术架构建议
### 前端
- Next.js框架
- WebSocket实时通信
- React Flow可视化

### 后端
- Python Flask
- AppBuilder SDK集成
- SQLite数据存储

## 5. 性能指标
### 响应时间
- 对话响应 < 2秒
- 代码生成 < 5秒

### 并发支持
- 支持50用户同时在线

### 可用性
- 系统可用性 > 99.9%

## 6. 安全性要求
- 用户数据加密存储
- 防止SQL注入
- 防止XSS攻击
- API访问限制

## 7. 后续迭代计划
### 第一期(MVP)
- 基础对话功能
- 简单代码生成
- 基础可视化

### 第二期
- 多语言支持
- 代码版本控制
- 高级可视化效果

### 第三期
- 用户账户系统
- 项目管理功能
- 协作模板库

## 8. 代码重构计划

### 8.1 重构目标
- 提高代码可维护性
- 减少重复代码
- 优化性能
- 增强可扩展性
- 标准化通信协议

### 8.2 前端重构重点
#### 组件层重构
- 创建公共UI组件库
- 优化组件层次结构
- 实现代码分割

#### 逻辑层重构
- 封装自定义Hooks
  - useWebSocket: 管理WebSocket连接
  - useMessageProcessor: 处理消息格式化
  - useLocalStorage: 管理本地存储
- 优化Context结构

#### 类型系统重构
- 统一类型定义
- 增强类型安全性
- 减少重复定义

### 8.3 后端重构重点
#### 服务层重构
- 分离业务逻辑
- 实现依赖注入
- 标准化错误处理

#### WebSocket通信标准化
- 定义消息类型枚举
- 统一消息格式
- 增强错误处理

#### 测试覆盖率提升
- 单元测试
- 集成测试
- 端到端测试

### 8.4 重构优先级
1. WebSocket消息处理
2. 前端自定义Hooks
3. 类型系统统一
4. 后端服务层分离
5. 错误处理机制
6. 测试覆盖率提升

### 8.5 重构风险管理
- 保持向后兼容
- 增量式重构
- 完善测试覆盖
- 详细记录变更 